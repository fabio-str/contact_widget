var PageTextWidget = {
    position: 'bottom-right',
    welcome_message: 'Send me a line',
    formHtml: '<%= j render "form" %>',
    cssStyles: "<% asset_url('tailwind.css') %>",
    circleStyles: {
        backgroundColor: 'black',
        height: '50px',
        width: '50px',
        borderRadius: '50%',
        position: 'absolute',
        bottom: '10px',
        right: '10px',
        cursor: 'pointer'
    },

    init: function() {
        console.log('Widget initialized!');
        this.showIcon();
        this.plantCss();
    },

    plantCss: function() {
        let stylesheet = document.createElement('link');
        stylesheet.rel = 'stylesheet';
        stylesheet.href = this.cssStyles;
        document.head.append(stylesheet);
    },

    showForm: function() {
        document.body.insertAdjacentHTML('beforeend', this.formHtml);
        document.getElementById('new_message').addEventListener('submit', this.submitForm);
        this.hideIcon();
    },

    hideForm: function() {
        document.getElementById('page_text_widget').remove();
        this.showIcon();
    },

    hideIcon: function() {
        document.getElementById('page_text_icon').remove();
    },

    showIcon: function() {
        let icon = document.createElement('span');
        icon.id = 'page_text_icon';
        icon.addEventListener('click', this.showForm.bind(this));
        Object.assign(icon.style, this.circleStyles);
        document.body.append(icon);
    },

    submitForm: function(e) {
        e.preventDefault();
        let form = e.target;
    
        fetch(form.action, {
          method: 'POST',
          body: new FormData(form)
        }).then((response) => {
          console.log('success response received! you hide the form and show a thank you message now.');
        })
    }
}

PageTextWidget.init();